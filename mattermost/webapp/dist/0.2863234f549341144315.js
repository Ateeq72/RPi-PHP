webpackJsonp([0],{1866:function(e,t,a){"use strict";(function(e){var n=a(6),r=n&&n.__esModule?function(){return n["default"]}:function(){return n};a.d(r,"a",r);var s=a(3),o=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(o,"a",o);var i=a(4),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var d=a(7),u=d&&d.__esModule?function(){return d["default"]}:function(){return d};a.d(u,"a",u);var c=a(2),m=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(m,"a",m);var h=a(232),f=a(565),p=a(152),g=a(322),v=a(18),C=a(37),M=a(13),_=a(1),E=_&&_.__esModule?function(){return _["default"]}:function(){return _};a.d(E,"a",E);var b=a(30),y=b&&b.__esModule?function(){return b["default"]}:function(){return b};a.d(y,"a",y);var w=a(12),T=w&&w.__esModule?function(){return w["default"]}:function(){return w};a.d(T,"a",T);var S=a(53),N=function(t){function a(e){o()(this,a);var t=u()(this,(a.__proto__||r()(a)).call(this,e));return t.handleHide=t.handleHide.bind(t),t.handleShowDirectChannel=t.handleShowDirectChannel.bind(t),t.handleUserChange=t.handleUserChange.bind(t),t.onTeamChange=t.onTeamChange.bind(t),t.createJoinDirectChannelButton=t.createJoinDirectChannelButton.bind(t),t.state={users:v.a.getProfilesForDmList(),teamMembers:C.a.getMembersForTeam(),loadingDMChannel:-1,usersLoaded:!1,teamMembersLoaded:!1},t}return m()(a,t),l()(a,[{key:"componentDidMount",value:function(){v.a.addDmListChangeListener(this.handleUserChange),C.a.addChangeListener(this.onTeamChange)}},{key:"componentWillUnmount",value:function(){v.a.removeDmListChangeListener(this.handleUserChange),C.a.removeChangeListener(this.onTeamChange)}},{key:"shouldComponentUpdate",value:function(e,t){return e.show!==this.props.show||(e.onModalDismissed.toString()!==this.props.onModalDismissed.toString()||(t.loadingDMChannel!==this.state.loadingDMChannel||(!M.areObjectsEqual(t.users,this.state.users)||!M.areObjectsEqual(t.teamMembers,this.state.teamMembers))))}},{key:"handleHide",value:function(){this.props.onModalDismissed&&this.props.onModalDismissed()}},{key:"handleShowDirectChannel",value:function(e,t){var a=this;t.preventDefault(),this.state.loadingDMChannel===-1&&(this.setState({loadingDMChannel:e.id}),M.openDirectChannelToUser(e,function(e){S.a.push(C.a.getCurrentTeamUrl()+"/channels/"+e.name),a.setState({loadingDMChannel:-1}),a.handleHide()},function(){a.setState({loadingDMChannel:-1})}))}},{key:"handleUserChange",value:function(){this.setState({users:v.a.getProfilesForDmList(),usersLoaded:!0})}},{key:"onTeamChange",value:function(){this.setState({teamMembers:C.a.getMembersForTeam(),teamMembersLoaded:!0})}},{key:"createJoinDirectChannelButton",value:function(e){var t=e.user;return E.a.createElement(f.a,{className:"btn btm-sm btn-primary",spinning:this.state.loadingDMChannel===t.id,onClick:this.handleShowDirectChannel.bind(this,t)},E.a.createElement(w.FormattedMessage,{id:"more_direct_channels.message",defaultMessage:"Message"}))}},{key:"render",value:function(){var t=1e3;M.windowHeight()<=1200&&(t=M.windowHeight()-300);var a=null;if(this.state.usersLoaded&&this.state.teamMembersLoaded){var n=!1;"any"===e.window.mm_config.RestrictDirectMessage&&(n=!0),a=E.a.createElement(h.a,{style:{maxHeight:t},users:this.state.users,teamMembers:this.state.teamMembers,actions:[this.createJoinDirectChannelButton],showTeamToggle:n})}else a=E.a.createElement(p.a,null);return E.a.createElement(b.Modal,{dialogClassName:"more-modal more-direct-channels",show:this.props.show,onHide:this.handleHide,onEntered:g.getMoreDmList},E.a.createElement(b.Modal.Header,{closeButton:!0},E.a.createElement(b.Modal.Title,null,E.a.createElement(w.FormattedMessage,{id:"more_direct_channels.title",defaultMessage:"Direct Messages"}))),E.a.createElement(b.Modal.Body,null,a),E.a.createElement(b.Modal.Footer,null,E.a.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},E.a.createElement(w.FormattedMessage,{id:"more_direct_channels.close",defaultMessage:"Close"}))))}}]),a}(E.a.Component);t.a=N,N.propTypes={show:E.a.PropTypes.bool.isRequired,onModalDismissed:E.a.PropTypes.func}}).call(t,a(17))},1868:function(e,t,a){"use strict";(function(e){var n=a(6),r=n&&n.__esModule?function(){return n["default"]}:function(){return n};a.d(r,"a",r);var s=a(3),o=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(o,"a",o);var i=a(4),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var d=a(7),u=d&&d.__esModule?function(){return d["default"]}:function(){return d};a.d(u,"a",u);var c=a(2),m=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(m,"a",m);var h=a(0),f=h&&h.__esModule?function(){return h["default"]}:function(){return h};a.d(f,"a",f);var p=a(23),g=p&&p.__esModule?function(){return p["default"]}:function(){return p};a.d(g,"a",g);var v=a(13),C=a(54),M=a(37),_=a(18),E=a(1642),b=a(1653),y=a(227),w=a(1654),T=a(11),S=a(12),N=S&&S.__esModule?function(){return S["default"]}:function(){return S};a.d(N,"a",N);var D=a(53),k=a(1),L=k&&k.__esModule?function(){return k["default"]}:function(){return k};a.d(L,"a",L);var U=function(t){function a(e){o()(this,a);var t=u()(this,(a.__proto__||r()(a)).call(this,e));return t.blockToggle=!1,t.handleAboutModal=t.handleAboutModal.bind(t),t.aboutModalDismissed=t.aboutModalDismissed.bind(t),t.onTeamChange=t.onTeamChange.bind(t),t.openAccountSettings=t.openAccountSettings.bind(t),t.renderCustomEmojiLink=t.renderCustomEmojiLink.bind(t),t.state={showUserSettingsModal:!1,showAboutModal:!1,teams:M.a.getAll(),teamMembers:M.a.getTeamMembers()},t}return m()(a,t),l()(a,[{key:"handleAboutModal",value:function(){this.setState({showAboutModal:!0})}},{key:"aboutModalDismissed",value:function(){this.setState({showAboutModal:!1})}},{key:"componentDidMount",value:function(){var e=this;f()(g.a.findDOMNode(this.refs.dropdown)).on("hide.bs.dropdown",function(){f()(".sidebar--left .dropdown-menu").scrollTop(0),e.blockToggle=!0,setTimeout(function(){e.blockToggle=!1},100)}),M.a.addChangeListener(this.onTeamChange),document.addEventListener("keydown",this.openAccountSettings)}},{key:"onTeamChange",value:function(){this.setState({teams:M.a.getAll(),teamMembers:M.a.getTeamMembers()})}},{key:"componentWillUnmount",value:function(){f()(g.a.findDOMNode(this.refs.dropdown)).off("hide.bs.dropdown"),M.a.removeChangeListener(this.onTeamChange),document.removeEventListener("keydown",this.openAccountSettings)}},{key:"openAccountSettings",value:function(e){v.cmdOrCtrlPressed(e)&&e.shiftKey&&e.keyCode===T.a.KeyCodes.A&&(e.preventDefault(),this.setState({showUserSettingsModal:!this.state.showUserSettingsModal}))}},{key:"renderCustomEmojiLink",value:function(){return"true"===window.mm_config.EnableCustomEmoji&&v.canCreateCustomEmoji(this.props.currentUser)?L.a.createElement("li",null,L.a.createElement(D.b,{to:"/"+this.props.teamName+"/emoji"},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.emoji",defaultMessage:"Custom Emoji"}))):null}},{key:"render",value:function(){var t=this,a=e.window.mm_config,n="",r="",s="",o="",i=this.props.currentUser,l=!1,d=!1,u=null,c=null;if(!i)return null;null!=i&&(l=M.a.isTeamAdminForCurrentTeam()||_.a.isSystemAdminForCurrentUser(),d=_.a.isSystemAdminForCurrentUser(),r=L.a.createElement("li",null,L.a.createElement("a",{href:"#",onClick:C.showInviteMemberModal},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.inviteMember",defaultMessage:"Invite New Member"}))),this.props.teamType===T.a.OPEN_TEAM&&"true"===a.EnableUserCreation&&(n=L.a.createElement("li",null,L.a.createElement("a",{href:"#",onClick:C.showGetTeamInviteLinkModal},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.teamLink",defaultMessage:"Get Team Invite Link"})))),"true"===e.window.mm_license.IsLicensed&&(a.RestrictTeamInvite!==T.a.PERMISSIONS_SYSTEM_ADMIN||d?a.RestrictTeamInvite!==T.a.PERMISSIONS_TEAM_ADMIN||l||(n=null,r=null):(n=null,r=null)));var m=L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.manageMembers",defaultMessage:"Manage Members"});l?u=L.a.createElement("li",null,L.a.createElement("a",{href:"#","data-toggle":"modal","data-target":"#team_settings"},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.teamSettings",defaultMessage:"Team Settings"}))):m=L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.viewMembers",defaultMessage:"View Members"}),s=L.a.createElement("li",null,L.a.createElement(y.a,{dialogType:b.a,dialogProps:{isAdmin:l}},m));var h="true"===a.EnableIncomingWebhooks||"true"===a.EnableOutgoingWebhooks||"true"===a.EnableCommands||"true"===a.EnableOAuthServiceProvider&&(d||"true"!==a.EnableOnlyAdminIntegrations);h&&(l||"true"!==a.EnableOnlyAdminIntegrations)&&(c=L.a.createElement("li",null,L.a.createElement(D.b,{to:"/"+this.props.teamName+"/integrations"},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.integrations",defaultMessage:"Integrations"})))),d&&(o=L.a.createElement("li",null,L.a.createElement(D.b,{to:"/admin_console"},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.console",defaultMessage:"System Console"}))));var f=[];if("true"===a.EnableTeamCreation&&f.push(L.a.createElement("li",{key:"newTeam_li"},L.a.createElement(D.b,{key:"newTeam_a",to:"/create_team"},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.create",defaultMessage:"Create a New Team"})))),f.push(L.a.createElement("li",{key:"leaveTeam_li"},L.a.createElement("a",{href:"#",onClick:C.showLeaveTeamModal},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.leave",defaultMessage:"Leave Team"})))),this.state.teamMembers&&this.state.teamMembers.length>1){f.push(L.a.createElement("li",{key:"teamDiv",className:"divider"}));for(var p in this.state.teamMembers)if(this.state.teamMembers.hasOwnProperty(p)){var g=this.state.teamMembers[p],v=this.state.teams[g.team_id];v.name!==this.props.teamName&&f.push(L.a.createElement("li",{key:"team_"+v.name},L.a.createElement(D.b,{to:"/"+v.name+"/channels/town-square"},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.switchTo",defaultMessage:"Switch to "}),v.display_name)))}}var N=null;a.HelpLink&&(N=L.a.createElement("li",null,L.a.createElement(D.b,{target:"_blank",rel:"noopener noreferrer",to:a.HelpLink},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.help",defaultMessage:"Help"}))));var k=null;a.ReportAProblemLink&&(k=L.a.createElement("li",null,L.a.createElement(D.b,{target:"_blank",rel:"noopener noreferrer",to:a.ReportAProblemLink},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.report",defaultMessage:"Report a Problem"}))));var U=null,A=null;return e.window.mm_config.AppDownloadLink&&(U=L.a.createElement("li",{className:"divider"}),A=L.a.createElement("li",null,L.a.createElement(D.b,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.AppDownloadLink},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.nativeApps",defaultMessage:"Download Apps"})))),L.a.createElement("ul",{className:"nav navbar-nav navbar-right"},L.a.createElement("li",{ref:"dropdown",className:"dropdown"},L.a.createElement("a",{href:"#",className:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-expanded":"false"},L.a.createElement("span",{className:"dropdown__icon",dangerouslySetInnerHTML:{__html:T.a.MENU_ICON}})),L.a.createElement("ul",{className:"dropdown-menu",role:"menu"},L.a.createElement("li",null,L.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.setState({showUserSettingsModal:!0})}},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.accountSettings",defaultMessage:"Account Settings"}))),r,n,L.a.createElement("li",null,L.a.createElement("a",{href:"#",onClick:C.emitUserLoggedOutEvent},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.logout",defaultMessage:"Logout"}))),L.a.createElement("li",{className:"divider"}),c,this.renderCustomEmojiLink(),L.a.createElement("li",{className:"divider"}),u,s,o,f,L.a.createElement("li",{className:"divider"}),N,k,L.a.createElement("li",null,L.a.createElement("a",{href:"#",onClick:this.handleAboutModal},L.a.createElement(S.FormattedMessage,{id:"navbar_dropdown.about",defaultMessage:"About Mattermost"}))),U,A,L.a.createElement(w.a,{show:this.state.showUserSettingsModal,onModalDismissed:function(){return t.setState({showUserSettingsModal:!1})}}),L.a.createElement(E.a,{show:this.state.showAboutModal,onModalDismissed:this.aboutModalDismissed}))))}}]),a}(L.a.Component);t.a=U,U.defaultProps={teamType:""},U.propTypes={teamType:L.a.PropTypes.string,teamDisplayName:L.a.PropTypes.string,teamName:L.a.PropTypes.string,currentUser:L.a.PropTypes.object}}).call(t,a(17))},1882:function(e,t,a){"use strict";var n=a(6),r=n&&n.__esModule?function(){return n["default"]}:function(){return n};a.d(r,"a",r);var s=a(3),o=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(o,"a",o);var i=a(4),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var d=a(7),u=d&&d.__esModule?function(){return d["default"]}:function(){return d};a.d(u,"a",u);var c=a(2),m=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(m,"a",m);var h=a(0),f=h&&h.__esModule?function(){return h["default"]}:function(){return h};a.d(f,"a",f);var p=a(1868),g=a(572),v=g&&g.__esModule?function(){return g["default"]}:function(){return g};a.d(v,"a",v);var C=a(45),M=a(13),_=a(19),E=a(11),b=a(30),y=b&&b.__esModule?function(){return b["default"]}:function(){return b};a.d(y,"a",y);var w=a(1637),T=a(1),S=T&&T.__esModule?function(){return T["default"]}:function(){return T};a.d(S,"a",S);var N=E.a.Preferences,D=E.a.TutorialSteps,k=function(e){function t(e){o()(this,t);var a=u()(this,(t.__proto__||r()(t)).call(this,e));return a.toggleDropdown=a.toggleDropdown.bind(a),a.onPreferenceChange=a.onPreferenceChange.bind(a),a.state=a.getStateFromStores(),a}return m()(t,e),l()(t,[{key:"componentDidMount",value:function(){C.a.addChangeListener(this.onPreferenceChange)}},{key:"componentWillUnmount",value:function(){C.a.removeChangeListener(this.onPreferenceChange)}},{key:"getStateFromStores",value:function(){var e=C.a.getInt(N.TUTORIAL_STEP,this.props.currentUser.id,999);return{showTutorialTip:e===D.MENU_POPOVER&&!M.isMobile()}}},{key:"onPreferenceChange",value:function(){this.setState(this.getStateFromStores())}},{key:"toggleDropdown",value:function(e){return e.preventDefault(),this.refs.dropdown.blockToggle?void(this.refs.dropdown.blockToggle=!1):void f()(".team__header").find(".dropdown-toggle").dropdown("toggle")}},{key:"render",value:function(){var e=this.props.currentUser,t=null;if(!e)return null;e.last_picture_update&&(t=S.a.createElement("img",{className:"user__picture",src:_.a.getUsersRoute()+"/"+e.id+"/image?time="+e.update_at}));var n=null;return this.state.showTutorialTip&&(n=a.i(w.a)(this.toggleDropdown)),S.a.createElement("div",{className:"team__header theme"},n,S.a.createElement("a",{href:"#",onClick:this.toggleDropdown},t,S.a.createElement("div",{className:"header__info"},S.a.createElement("div",{className:"user__name"},"@"+e.username),S.a.createElement(b.OverlayTrigger,{trigger:["hover","focus"],delayShow:1e3,placement:"bottom",overlay:S.a.createElement(b.Tooltip,{id:"team-name__tooltip"},this.props.teamDisplayName),ref:"descriptionOverlay"},S.a.createElement("div",{className:"team__name"},this.props.teamDisplayName)))),S.a.createElement(p.a,{ref:"dropdown",teamType:this.props.teamType,teamDisplayName:this.props.teamDisplayName,teamName:this.props.teamName,currentUser:this.props.currentUser}))}}]),t}(S.a.Component);t.a=k,k.defaultProps={teamDisplayName:"",teamType:""},k.propTypes={teamDisplayName:S.a.PropTypes.string,teamName:S.a.PropTypes.string,teamType:S.a.PropTypes.string,currentUser:S.a.PropTypes.object}},1891:function(e,t,a){"use strict";var n=a(6),r=n&&n.__esModule?function(){return n["default"]}:function(){return n};a.d(r,"a",r);var s=a(3),o=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(o,"a",o);var i=a(4),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var d=a(7),u=d&&d.__esModule?function(){return d["default"]}:function(){return d};a.d(u,"a",u);var c=a(2),m=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(m,"a",m);var h=a(1),f=h&&h.__esModule?function(){return h["default"]}:function(){return h};a.d(f,"a",f);var p=function(e){function t(){return o()(this,t),u()(this,(t.__proto__||r()(t)).apply(this,arguments))}return m()(t,e),l()(t,[{key:"render",value:function(){var e="none";return this.props.show&&(e="block"),f.a.createElement("div",{className:"nav-pills__unread-indicator "+this.props.extraClass,style:{display:e}},this.props.text)}}]),t}(f.a.Component);t.a=p,p.defaultProps={show:!1,extraClass:"",text:""},p.propTypes={show:f.a.PropTypes.bool,extraClass:f.a.PropTypes.string,text:f.a.PropTypes.object}},1895:function(e,t,a){e.exports=a.p+"files/2c9d31cec343005b617e3b39fdb20895.png"},325:function(e,t,a){"use strict";(function(e){var n=a(114),r=n&&n.__esModule?function(){return n["default"]}:function(){return n};a.d(r,"a",r);var s=a(47),o=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(o,"a",o);var i=a(112),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var d=a(42),u=d&&d.__esModule?function(){return d["default"]}:function(){return d};a.d(u,"a",u);var c=a(40),m=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(m,"a",m);var h=a(98),f=h&&h.__esModule?function(){return h["default"]}:function(){return h};a.d(f,"a",f);var p=a(6),g=p&&p.__esModule?function(){return p["default"]}:function(){return p};a.d(g,"a",g);var v=a(3),C=v&&v.__esModule?function(){return v["default"]}:function(){return v};a.d(C,"a",C);var M=a(4),_=M&&M.__esModule?function(){return M["default"]}:function(){return M};a.d(_,"a",_);var E=a(7),b=E&&E.__esModule?function(){return E["default"]}:function(){return E};a.d(b,"a",b);var y=a(2),w=y&&y.__esModule?function(){return y["default"]}:function(){return y};a.d(w,"a",w);var T=a(0),S=T&&T.__esModule?function(){return T["default"]}:function(){return T};a.d(S,"a",S);var N=a(23),D=N&&N.__esModule?function(){return N["default"]}:function(){return N};a.d(D,"a",D);var k=a(1650),L=a(1866),U=a(1882),A=a(1891),P=a(1637),F=a(1638),I=a(36),O=a(18),H=a(37),R=a(45),B=a(26),x=a(13),j=a(568),q=a(11),K=a(12),W=K&&K.__esModule?function(){return K["default"]}:function(){return K};a.d(W,"a",W);var J=a(30),G=J&&J.__esModule?function(){return J["default"]}:function(){return J};a.d(G,"a",G);var Y=a(113),V=Y&&Y.__esModule?function(){return Y["default"]}:function(){return Y};a.d(V,"a",V);var z=a(1),Q=z&&z.__esModule?function(){return z["default"]}:function(){return z};a.d(Q,"a",Q);var X=a(53),Z=a(589),$=Z&&Z.__esModule?function(){return Z["default"]}:function(){return Z};a.d($,"a",$);var ee=a(1895),te=ee&&ee.__esModule?function(){return ee["default"]}:function(){return ee};a.d(te,"a",te);var ae=q.a.Preferences,ne=q.a.TutorialSteps,re=function(t){function a(e){C()(this,a);var t=b()(this,(a.__proto__||g()(a)).call(this,e));t.badgesActive=!1,t.firstUnreadChannel=null,t.lastUnreadChannel=null,t.getStateFromStores=t.getStateFromStores.bind(t),t.onChange=t.onChange.bind(t),t.onScroll=t.onScroll.bind(t),t.updateUnreadIndicators=t.updateUnreadIndicators.bind(t),t.handleLeaveDirectChannel=t.handleLeaveDirectChannel.bind(t),t.showMoreChannelsModal=t.showMoreChannelsModal.bind(t),t.showNewChannelModal=t.showNewChannelModal.bind(t),t.hideNewChannelModal=t.hideNewChannelModal.bind(t),t.showMoreDirectChannelsModal=t.showMoreDirectChannelsModal.bind(t),t.hideMoreDirectChannelsModal=t.hideMoreDirectChannelsModal.bind(t),t.createChannelElement=t.createChannelElement.bind(t),t.updateTitle=t.updateTitle.bind(t),t.navigateChannelShortcut=t.navigateChannelShortcut.bind(t),t.navigateUnreadChannelShortcut=t.navigateUnreadChannelShortcut.bind(t),t.getDisplayedChannels=t.getDisplayedChannels.bind(t),t.updateScrollbarOnChannelChange=t.updateScrollbarOnChannelChange.bind(t),t.isLeaving=new f.a,t.isSwitchingChannel=!1;var n=t.getStateFromStores();return n.newChannelModalType="",n.showDirectChannelsModal=!1,n.loadingDMChannel=-1,t.state=n,t}return w()(a,t),_()(a,[{key:"getTotalUnreadCount",value:function(){var e=this,t=0,a=0,n=this.state.unreadCounts;return m()(n).forEach(function(r){var s=I.a.get(r);!s||s.team_id&&s.team_id!==e.state.currentTeam.id||(t+=n[r].msgs,a+=n[r].mentions)}),{msgs:t,mentions:a}}},{key:"getStateFromStores",value:function(){var e=I.a.getAllMembers(),t=I.a.getCurrentId(),a=O.a.getCurrentId(),n=u()([],I.a.getAll());n.sort(this.sortChannelsByDisplayName);var s=n.filter(function(e){return e.type===q.a.OPEN_CHANNEL}),i=n.filter(function(e){return e.type===q.a.PRIVATE_CHANNEL}),d=R.a.getCategory(q.a.Preferences.CATEGORY_DIRECT_CHANNEL_SHOW),c=[],m=[],h=!0,f=!1,p=void 0;try{for(var g,v=o()(d);!(h=(g=v.next()).done);h=!0){var C=r()(g.value,2),M=C[0],_=C[1];if("true"===_){var E=M,b=n.find(x.isDirectChannelForUser.bind(null,E));b=null==b?{name:x.getDirectChannelName(a,E),last_post_at:0,total_msg_count:0,type:q.a.DM_CHANNEL,fake:!0}:JSON.parse(l()(b)),b.display_name=x.displayUsername(E),b.teammate_id=E,b.status=O.a.getStatus(E)||"offline",O.a.hasTeamProfile(E)&&H.a.hasActiveMemberForTeam(E)?c.push(b):m.push(b)}}}catch(y){f=!0,p=y}finally{try{!h&&v["return"]&&v["return"]()}finally{if(f)throw p}}c.sort(this.sortChannelsByDisplayName),m.sort(this.sortChannelsByDisplayName);var w=R.a.getInt(ae.TUTORIAL_STEP,O.a.getCurrentId(),999);return{activeId:t,members:e,publicChannels:s,privateChannels:i,directChannels:c,directNonTeamChannels:m,unreadCounts:JSON.parse(l()(I.a.getUnreadCounts())),showTutorialTip:w===ne.CHANNEL_POPOVER,currentTeam:H.a.getCurrent(),currentUser:O.a.getCurrentUser(),townSquare:I.a.getByName(q.a.DEFAULT_CHANNEL),offTopic:I.a.getByName(q.a.OFFTOPIC_CHANNEL)}}},{key:"componentDidMount",value:function(){I.a.addChangeListener(this.onChange),O.a.addChangeListener(this.onChange),O.a.addStatusesChangeListener(this.onChange),H.a.addChangeListener(this.onChange),R.a.addChangeListener(this.onChange),this.updateTitle(),this.updateUnreadIndicators(),document.addEventListener("keydown",this.navigateChannelShortcut),document.addEventListener("keydown",this.navigateUnreadChannelShortcut)}},{key:"shouldComponentUpdate",value:function(e,t){return!x.areObjectsEqual(t,this.state)}},{key:"componentDidUpdate",value:function(e,t){this.updateTitle(),this.updateUnreadIndicators(),x.isMobile()||S()(".sidebar--left .nav-pills__container").perfectScrollbar(),this.state.currentTeam!==t.currentTeam&&(this.refs.container.scrollTop=0,S()(".nav-pills__container").perfectScrollbar("update")),this.state.activeId!==t.activeId&&(S()(".app__body .inner-wrap").removeClass("move--right"),S()(".app__body .sidebar--left").removeClass("move--right"))}},{key:"componentWillUnmount",value:function(){I.a.removeChangeListener(this.onChange),O.a.removeChangeListener(this.onChange),O.a.removeStatusesChangeListener(this.onChange),H.a.removeChangeListener(this.onChange),R.a.removeChangeListener(this.onChange),document.removeEventListener("keydown",this.navigateChannelShortcut),document.removeEventListener("keydown",this.navigateUnreadChannelShortcut)}},{key:"onChange",value:function(){this.setState(this.getStateFromStores())}},{key:"updateTitle",value:function(){var t=I.a.getCurrent();if(t&&this.state.currentTeam){var a="";null!=e.window.mm_config.SiteName&&(a=e.window.mm_config.SiteName);var n=t.display_name;if("D"===t.type){var r=x.getDirectTeammate(t.id);null!=r&&(n=r.username)}var s=this.getTotalUnreadCount(),o=s.mentions>0?"("+s.mentions+") ":"",i=s.msgs>0?"* ":"";document.title=o+i+n+" - "+this.state.currentTeam.display_name+" "+a}}},{key:"onScroll",value:function(){this.updateUnreadIndicators()}},{key:"updateUnreadIndicators",value:function(){var e=S()(D.a.findDOMNode(this.refs.container)),t=!1,a=!1;if(this.firstUnreadChannel){var n=S()(D.a.findDOMNode(this.refs[this.firstUnreadChannel]));n.position().top+n.height()<0&&(t=!0)}if(this.lastUnreadChannel){var r=S()(D.a.findDOMNode(this.refs[this.lastUnreadChannel]));r.position().top>e.height()&&(a=!0)}this.setState({showTopUnread:t,showBottomUnread:a})}},{key:"updateScrollbarOnChannelChange",value:function(e){var t=this.refs[e.name].getBoundingClientRect();(t.top-q.a.CHANNEL_SCROLL_ADJUSTMENT<0||t.top+t.height>this.refs.container.getBoundingClientRect().height)&&(this.refs.container.scrollTop=this.refs.container.scrollTop+(t.top-q.a.CHANNEL_SCROLL_ADJUSTMENT),S()(".nav-pills__container").perfectScrollbar("update"))}},{key:"navigateChannelShortcut",value:function(e){if(e.altKey&&!e.shiftKey&&(e.keyCode===q.a.KeyCodes.UP||e.keyCode===q.a.KeyCodes.DOWN)){if(e.preventDefault(),this.isSwitchingChannel)return;this.isSwitchingChannel=!0;for(var t=this.getDisplayedChannels(),a=this.state.activeId,n=-1,r=0;r<t.length;r++)t[r].id===a&&(n=r);var s=t[n],o=n;e.keyCode===q.a.KeyCodes.DOWN?o=n+1:e.keyCode===q.a.KeyCodes.UP&&(o=n-1),s=t[x.mod(o,t.length)],j.goToChannel(s),this.updateScrollbarOnChannelChange(s),this.isSwitchingChannel=!1}}},{key:"navigateUnreadChannelShortcut",value:function(e){if(e.altKey&&e.shiftKey&&(e.keyCode===q.a.KeyCodes.UP||e.keyCode===q.a.KeyCodes.DOWN)){if(e.preventDefault(),this.isSwitchingChannel)return;this.isSwitchingChannel=!0;for(var t=this.getDisplayedChannels(),a=this.state.activeId,n=-1,r=0;r<t.length;r++)t[r].id===a&&(n=r);var s=t[n],o=n,i=0,l=0;e.keyCode===q.a.KeyCodes.UP?l=-1:e.keyCode===q.a.KeyCodes.DOWN&&(l=1);for(var d=I.a.getUnreadCount(t[o].id);i<t.length&&0===d.msgs&&0===d.mentions;)o+=l,i++,o=x.mod(o,t.length),d=I.a.getUnreadCount(t[o].id);0===d.msgs&&0===d.mentions||(s=t[o],j.goToChannel(s),this.updateScrollbarOnChannelChange(s),this.isSwitchingChannel=!1)}}},{key:"getDisplayedChannels",value:function(){return this.state.publicChannels.concat(this.state.privateChannels).concat(this.state.directChannels).concat(this.state.directNonTeamChannels)}},{key:"handleLeaveDirectChannel",value:function(e,t){var a=this;e.preventDefault(),this.isLeaving.get(t.id)||(this.isLeaving.set(t.id,!0),B.savePreference(q.a.Preferences.CATEGORY_DIRECT_CHANNEL_SHOW,t.teammate_id,"false",function(){a.isLeaving.set(t.id,!1)},function(){a.isLeaving.set(t.id,!1)}),this.setState(this.getStateFromStores())),t.id===this.state.activeId&&X.a.push("/"+this.state.currentTeam.name+"/channels/town-square")}},{key:"sortChannelsByDisplayName",value:function(e,t){return e.display_name===t.display_name?e.name.localeCompare(t.name):e.display_name.localeCompare(t.display_name)}},{key:"showMoreChannelsModal",value:function(){S()("#more_channels").modal({"data-channeltype":"O"}).modal("show")}},{key:"showNewChannelModal",value:function(e){this.setState({newChannelModalType:e})}},{key:"hideNewChannelModal",value:function(){this.setState({newChannelModalType:""})}},{key:"showMoreDirectChannelsModal",value:function(){this.setState({showDirectChannelsModal:!0})}},{key:"hideMoreDirectChannelsModal",value:function(){this.setState({showDirectChannelsModal:!1})}},{key:"openLeftSidebar",value:function(){x.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.add("move--right"),document.querySelector(".app__body .sidebar--left").classList.add("move--right")})}},{key:"createTutorialTip",value:function(){var e=[],t=q.a.DEFAULT_CHANNEL_UI_NAME;this.state.townSquare&&(t=this.state.townSquare.display_name);var a=q.a.OFFTOPIC_CHANNEL_UI_NAME;return this.state.offTopic&&(a=this.state.offTopic.display_name),e.push(Q.a.createElement("div",null,Q.a.createElement(K.FormattedHTMLMessage,{id:"sidebar.tutorialScreen1",defaultMessage:"<h4>Channels</h4><p><strong>Channels</strong> organize conversations across different topics. They’re open to everyone on your team. To send private communications use <strong>Direct Messages</strong> for a single person or <strong>Private Groups</strong> for multiple people.</p>"}))),e.push(Q.a.createElement("div",null,Q.a.createElement(K.FormattedHTMLMessage,{id:"sidebar.tutorialScreen2",defaultMessage:'<h4>"{townsquare}" and "{offtopic}" channels</h4> <p>Here are two public channels to start:</p> <p><strong>{townsquare}</strong> is a place for team-wide communication. Everyone in your team is a member of this channel.</p> <p><strong>{offtopic}</strong> is a place for fun and humor outside of work-related channels. You and your team can decide what other channels to create.</p>',values:{townsquare:t,offtopic:a}}))),e.push(Q.a.createElement("div",null,Q.a.createElement(K.FormattedHTMLMessage,{id:"sidebar.tutorialScreen3",defaultMessage:'<h4>Creating and Joining Channels</h4> <p>Click <strong>"More..."</strong> to create a new channel or join an existing one.</p> <p>You can also create a new channel or private group by clicking the <strong>"+" symbol</strong> next to the channel or private group header.</p>'}))),Q.a.createElement(P.b,{placement:"right",screens:e,overlayClass:"tip-overlay--sidebar"})}},{key:"createChannelElement",value:function(e,t,a,n){var r=this.state.members,s=this.state.activeId,o=r[e.id],i=this.state.unreadCounts[e.id]||{msgs:0,mentions:0},d=void 0,u="";e.id===s&&(u="active");var c="sidebar-channel",m=!1;o&&(d=i.msgs+i.mentions,m=d>0||o.mention_count>0),m&&(c+=" unread-title",e.id!==s&&(this.firstUnreadChannel||(this.firstUnreadChannel=e.name),this.lastUnreadChannel=e.name));var h=null;o?i.mentions&&(h=Q.a.createElement("span",{className:"badge pull-right small"},i.mentions),this.badgesActive=!0):this.state.loadingDMChannel===t&&"D"===e.type&&(h=Q.a.createElement("img",{className:"channel-loading-gif pull-right",src:V.a})),d>0&&(c+=" has-badge");var f=null;f="O"===e.type?Q.a.createElement("div",{className:"status"},Q.a.createElement("i",{className:"fa fa-globe"})):"P"===e.type?Q.a.createElement("div",{className:"status"},Q.a.createElement("i",{className:"fa fa-lock"})):Q.a.createElement(F.a,{status:e.status});var p=null,g=Q.a.createElement(J.Tooltip,{id:"remove-dm-tooltip"},Q.a.createElement(K.FormattedMessage,{id:"sidebar.removeList",defaultMessage:"Remove from list"}));n&&!h&&(p=Q.a.createElement(J.OverlayTrigger,{delayShow:1e3,placement:"top",overlay:g},Q.a.createElement("span",{onClick:function(t){return n(t,e)},className:"btn-close"},"×")),c+=" has-close");var v=null;this.state.showTutorialTip&&e.name===q.a.DEFAULT_CHANNEL&&(v=this.createTutorialTip(),this.openLeftSidebar());var C="";return C=e.fake?"/"+this.state.currentTeam.name+"/channels/"+e.name+"?fakechannel="+encodeURIComponent(l()(e)):"/"+this.state.currentTeam.name+"/channels/"+e.name,Q.a.createElement("li",{key:e.name,ref:e.name,className:u},Q.a.createElement(X.b,{to:C,className:c},f,e.display_name,h,p),v)}},{key:"render",value:function(){var t=this;if(null==this.state.currentTeam||null==this.state.currentUser)return Q.a.createElement("div",null);this.lastBadgesActive=this.badgesActive,this.badgesActive=!1,this.firstUnreadChannel=null,this.lastUnreadChannel=null;var a=this.state.publicChannels.map(this.createChannelElement),n=this.state.privateChannels.map(this.createChannelElement),r=this.state.directChannels.map(function(e,a,n){return t.createChannelElement(e,a,n,t.handleLeaveDirectChannel)}),s=this.state.directNonTeamChannels.map(function(e,a,n){return t.createChannelElement(e,a,n,t.handleLeaveDirectChannel)}),o=void 0;if(0!==s.length&&(o=Q.a.createElement("div",{className:"sidebar__divider"},Q.a.createElement("div",{className:"sidebar__divider__text"},Q.a.createElement(K.FormattedMessage,{id:"sidebar.otherMembers",defaultMessage:"Outside this team"})))),this.lastBadgesActive!==this.badgesActive){var i=document.createElement("link");i.type="image/x-icon",i.rel="shortcut icon",i.id="favicon",this.badgesActive?i.href=te.a:i.href=$.a;var l=document.getElementsByTagName("head")[0],d=document.getElementById("favicon");d&&l.removeChild(d),l.appendChild(i)}var u=Q.a.createElement("li",{key:"more"},Q.a.createElement("a",{href:"#",onClick:this.showMoreDirectChannelsModal
},Q.a.createElement(K.FormattedMessage,{id:"sidebar.moreElips",defaultMessage:"More..."}))),c=!1;""!==this.state.newChannelModalType&&(c=!0);var m=Q.a.createElement(J.Tooltip,{id:"new-channel-tooltip"},Q.a.createElement(K.FormattedMessage,{id:"sidebar.createChannel",defaultMessage:"Create new channel"})),h=Q.a.createElement(J.Tooltip,{id:"new-group-tooltip"},Q.a.createElement(K.FormattedMessage,{id:"sidebar.createGroup",defaultMessage:"Create new group"})),f=Q.a.createElement(K.FormattedMessage,{id:"sidebar.unreadAbove",defaultMessage:"Unread post(s) above"}),p=Q.a.createElement(K.FormattedMessage,{id:"sidebar.unreadBelow",defaultMessage:"Unread post(s) below"}),g=H.a.isTeamAdminForCurrentTeam()||O.a.isSystemAdminForCurrentUser(),v=O.a.isSystemAdminForCurrentUser(),C=Q.a.createElement(J.OverlayTrigger,{delayShow:500,placement:"top",overlay:m},Q.a.createElement("a",{className:"add-channel-btn",href:"#",onClick:this.showNewChannelModal.bind(this,q.a.OPEN_CHANNEL)},"+")),M=Q.a.createElement(J.OverlayTrigger,{delayShow:500,placement:"top",overlay:h},Q.a.createElement("a",{className:"add-channel-btn",href:"#",onClick:this.showNewChannelModal.bind(this,q.a.PRIVATE_CHANNEL)},"+"));return"true"===e.window.mm_license.IsLicensed&&(e.window.mm_config.RestrictPublicChannelManagement!==q.a.PERMISSIONS_SYSTEM_ADMIN||v?e.window.mm_config.RestrictPublicChannelManagement!==q.a.PERMISSIONS_TEAM_ADMIN||g||(C=null):C=null,e.window.mm_config.RestrictPrivateChannelManagement!==q.a.PERMISSIONS_SYSTEM_ADMIN||v?e.window.mm_config.RestrictPrivateChannelManagement!==q.a.PERMISSIONS_TEAM_ADMIN||g||(M=null):M=null),Q.a.createElement("div",{className:"sidebar--left",id:"sidebar-left",key:"sidebar-left"},Q.a.createElement(k.a,{show:c,channelType:this.state.newChannelModalType,onModalDismissed:this.hideNewChannelModal}),Q.a.createElement(L.a,{show:this.state.showDirectChannelsModal,onModalDismissed:this.hideMoreDirectChannelsModal}),Q.a.createElement(U.a,{teamDisplayName:this.state.currentTeam.display_name,teamName:this.state.currentTeam.name,teamType:this.state.currentTeam.type,currentUser:this.state.currentUser}),Q.a.createElement(A.a,{show:this.state.showTopUnread,extraClass:"nav-pills__unread-indicator-top",text:f}),Q.a.createElement(A.a,{show:this.state.showBottomUnread,extraClass:"nav-pills__unread-indicator-bottom",text:p}),Q.a.createElement("div",{ref:"container",className:"nav-pills__container",onScroll:this.onScroll},Q.a.createElement("ul",{className:"nav nav-pills nav-stacked"},Q.a.createElement("li",null,Q.a.createElement("h4",null,Q.a.createElement(K.FormattedMessage,{id:"sidebar.channels",defaultMessage:"Channels"}),C)),a,Q.a.createElement("li",null,Q.a.createElement("a",{href:"#",className:"nav-more",onClick:this.showMoreChannelsModal},Q.a.createElement(K.FormattedMessage,{id:"sidebar.moreElips",defaultMessage:"More..."})))),Q.a.createElement("ul",{className:"nav nav-pills nav-stacked"},Q.a.createElement("li",null,Q.a.createElement("h4",null,Q.a.createElement(K.FormattedMessage,{id:"sidebar.pg",defaultMessage:"Private Groups"}),M)),n),Q.a.createElement("ul",{className:"nav nav-pills nav-stacked"},Q.a.createElement("li",null,Q.a.createElement("h4",null,Q.a.createElement(K.FormattedMessage,{id:"sidebar.direct",defaultMessage:"Direct Messages"}))),r,o,s,u)))}}]),a}(Q.a.Component);t["default"]=re}).call(t,a(17))}});