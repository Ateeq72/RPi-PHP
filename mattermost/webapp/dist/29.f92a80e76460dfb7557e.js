webpackJsonp([29],{1689:function(e,t,n){"use strict";(function(e){var a=n(6),r=a&&a.__esModule?function(){return a["default"]}:function(){return a};n.d(r,"a",r);var o=n(3),s=o&&o.__esModule?function(){return o["default"]}:function(){return o};n.d(s,"a",s);var i=n(4),d=i&&i.__esModule?function(){return i["default"]}:function(){return i};n.d(d,"a",d);var u=n(7),l=u&&u.__esModule?function(){return u["default"]}:function(){return u};n.d(l,"a",l);var c=n(2),f=c&&c.__esModule?function(){return c["default"]}:function(){return c};n.d(f,"a",f);var p=n(0),v=p&&p.__esModule?function(){return p["default"]}:function(){return p};n.d(v,"a",v);var m=n(152),h=n(26),g=n(18),_=n(85),w=n(45),y=n(13),C=n(54),b=n(573),E=n(11),U=n(53),k=n(1),S=k&&k.__esModule?function(){return k["default"]}:function(){return k};n.d(S,"a",S);var M=(n(175),8),x=function(t){function n(e){s()(this,n);var t=l()(this,(n.__proto__||r()(n)).call(this,e));t.onUserChanged=t.onUserChanged.bind(t),t.setupUser=t.setupUser.bind(t),v()(window).bind("storage",function(e){if("__logout__"===e.originalEvent.key&&e.originalEvent.storageArea===localStorage&&e.originalEvent.newValue){if(_.a.isSignallingLogout(e.originalEvent.newValue))return;console.log("detected logout from a different tab"),U.a.push("/")}if("__login__"===e.originalEvent.key&&e.originalEvent.storageArea===localStorage&&e.originalEvent.newValue){if(_.a.isSignallingLogin(e.originalEvent.newValue))return;console.log("detected login from a different tab"),location.reload()}}),v()("#root").attr("class","channel-view");var a=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);a&&v()("body").addClass("ios");var o=w.a.get(E.a.Preferences.CATEGORY_DISPLAY_SETTINGS,"selected_font",E.a.DEFAULT_FONT);return y.applyFont(o),t.state={user:g.a.getCurrentUser()},t.state.user?t.setupUser(t.state.user):C.emitUserLoggedOutEvent("/login"),t}return f()(n,t),d()(n,[{key:"isValidState",value:function(){return null!=this.state.user}},{key:"setupUser",value:function(t){null!=e.window.mm_config.SegmentDeveloperKey&&""!==e.window.mm_config.SegmentDeveloperKey&&e.window.analytics.identify(t.id,{createdAt:t.create_at,id:t.id})}},{key:"onUserChanged",value:function(){var e=g.a.getCurrentUser();y.areObjectsEqual(this.state.user,e)||(this.setupUser(e),this.setState({user:e}))}},{key:"componentDidMount",value:function(){b.initialize(),g.a.addChangeListener(this.onUserChanged),v()("body").on("mouseenter mouseleave",".post",function(e){"mouseenter"===e.type?(v()(this).parent("div").prev(".date-separator, .new-separator").addClass("hovered--after"),v()(this).parent("div").next(".date-separator, .new-separator").addClass("hovered--before")):(v()(this).parent("div").prev(".date-separator, .new-separator").removeClass("hovered--after"),v()(this).parent("div").next(".date-separator, .new-separator").removeClass("hovered--before"))}),v()("body").on("mouseenter mouseleave",".search-item__container .post",function(e){"mouseenter"===e.type?(v()(this).closest(".search-item__container").find(".date-separator").addClass("hovered--after"),v()(this).closest(".search-item__container").next("div").find(".date-separator").addClass("hovered--before")):(v()(this).closest(".search-item__container").find(".date-separator").removeClass("hovered--after"),v()(this).closest(".search-item__container").next("div").find(".date-separator").removeClass("hovered--before"))}),v()("body").on("mouseenter mouseleave",".post.post--comment.same--root",function(e){"mouseenter"===e.type?(v()(this).parent("div").prev(".date-separator, .new-separator").addClass("hovered--comment"),v()(this).parent("div").next(".date-separator, .new-separator").addClass("hovered--comment")):(v()(this).parent("div").prev(".date-separator, .new-separator").removeClass("hovered--comment"),v()(this).parent("div").next(".date-separator, .new-separator").removeClass("hovered--comment"))}),v()(window).on("keydown.preventBackspace",function(e){e.which!==M||v()(e.target).is("input, textarea")||e.preventDefault()}),"true"===window.mm_config.EnableCustomEmoji&&h.listEmoji()}},{key:"componentWillUnmount",value:function(){v()("#root").attr("class",""),b.close(),g.a.removeChangeListener(this.onUserChanged),v()("body").off("click.userpopover"),v()("body").off("mouseenter mouseleave",".post"),v()("body").off("mouseenter mouseleave",".post.post--comment.same--root"),v()(".modal").off("show.bs.modal"),v()(window).off("keydown.preventBackspace")}},{key:"render",value:function(){return this.isValidState()?S.a.cloneElement(this.props.children,{user:this.state.user}):S.a.createElement(m.a,null)}}]),n}(S.a.Component);t["default"]=x,x.propTypes={children:S.a.PropTypes.object}}).call(t,n(17))}});