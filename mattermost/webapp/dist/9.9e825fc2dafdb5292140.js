webpackJsonp([9],{1657:function(e,t,a){"use strict";var s=a(6),n=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(n,"a",n);var r=a(3),o=r&&r.__esModule?function(){return r["default"]}:function(){return r};a.d(o,"a",o);var i=a(4),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var u=a(7),d=u&&u.__esModule?function(){return u["default"]}:function(){return u};a.d(d,"a",d);var c=a(2),h=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(h,"a",h);var p=a(0),f=p&&p.__esModule?function(){return p["default"]}:function(){return p};a.d(f,"a",f);var g=a(1),_=g&&g.__esModule?function(){return g["default"]}:function(){return g};a.d(_,"a",_);var v=a(1644),S=a(1648),E=a(1850),T=a(1871),m=a(36),C=a(13),P=function(e){function t(e){o()(this,t);var a=d()(this,(t.__proto__||n()(t)).call(this,e));return a.getStateFromStores=a.getStateFromStores.bind(a),a.isStateValid=a.isStateValid.bind(a),a.updateState=a.updateState.bind(a),a.state=a.getStateFromStores(e),a}return h()(t,e),l()(t,[{key:"getStateFromStores",value:function(e){var t=m.a.getByName(e.params.channel),a=t?t.id:"";return{channelId:a}}},{key:"isStateValid",value:function(){return""!==this.state.channelId}},{key:"updateState",value:function(){this.setState(this.getStateFromStores(this.props))}},{key:"componentDidMount",value:function(){m.a.addChangeListener(this.updateState),f()("body").addClass("app__body")}},{key:"componentWillUnmount",value:function(){m.a.removeChangeListener(this.updateState),f()("body").removeClass("app__body")}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.getStateFromStores(e))}},{key:"shouldComponentUpdate",value:function(e,t){return!C.areObjectsEqual(e.params,this.props.params)||t.channelId!==this.state.channelId}},{key:"render",value:function(){return _.a.createElement("div",{id:"app-content",className:"app__content"},_.a.createElement(S.a,{overlayType:"center"}),_.a.createElement(v.a,{channelId:this.state.channelId}),_.a.createElement(T.a,null),_.a.createElement("div",{className:"post-create__container",id:"post-create"},_.a.createElement(E.a,null)))}}]),t}(_.a.Component);t["default"]=P,P.defaultProps={},P.propTypes={params:_.a.PropTypes.object.isRequired}},1850:function(e,t,a){"use strict";var s=a(42),n=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(n,"a",n);var r=a(6),o=r&&r.__esModule?function(){return r["default"]}:function(){return r};a.d(o,"a",o);var i=a(3),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var u=a(4),d=u&&u.__esModule?function(){return u["default"]}:function(){return u};a.d(d,"a",d);var c=a(7),h=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(h,"a",h);var p=a(2),f=p&&p.__esModule?function(){return p["default"]}:function(){return p};a.d(f,"a",f);var g=a(23),_=g&&g.__esModule?function(){return g["default"]}:function(){return g};a.d(_,"a",_);var v=a(1649),S=a(1639),E=a(1647),T=a(1646),m=a(1651),C=a(1637),P=a(25),I=P&&P.__esModule?function(){return P["default"]}:function(){return P};a.d(I,"a",I);var y=a(54),A=a(19),D=a(13),M=a(75),L=a(568),N=a(36),w=a(153),b=a(1640),O=a(18),Y=a(45),k=a(11),G=a(12),U=G&&G.__esModule?function(){return G["default"]}:function(){return G};a.d(U,"a",U);var R=a(53),x=a(1),V=x&&x.__esModule?function(){return x["default"]}:function(){return x};a.d(V,"a",V);var F=k.a.Preferences,K=k.a.TutorialSteps,H=k.a.ActionTypes,B=k.a.KeyCodes,W=function(e){function t(e){l()(this,t);var a=h()(this,(t.__proto__||o()(t)).call(this,e));a.lastTime=0,a.getCurrentDraft=a.getCurrentDraft.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.postMsgKeyPress=a.postMsgKeyPress.bind(a),a.handleInput=a.handleInput.bind(a),a.handleUploadClick=a.handleUploadClick.bind(a),a.handleUploadStart=a.handleUploadStart.bind(a),a.handleFileUploadComplete=a.handleFileUploadComplete.bind(a),a.handleUploadError=a.handleUploadError.bind(a),a.removePreview=a.removePreview.bind(a),a.onChange=a.onChange.bind(a),a.onPreferenceChange=a.onPreferenceChange.bind(a),a.getFileCount=a.getFileCount.bind(a),a.handleKeyDown=a.handleKeyDown.bind(a),a.sendMessage=a.sendMessage.bind(a),a.focusTextbox=a.focusTextbox.bind(a),a.showPostDeletedModal=a.showPostDeletedModal.bind(a),a.hidePostDeletedModal=a.hidePostDeletedModal.bind(a),a.showShortcuts=a.showShortcuts.bind(a),w.a.clearDraftUploads();var s=a.getCurrentDraft();return a.state={channelId:N.a.getCurrentId(),messageText:s.messageText,uploadsInProgress:s.uploadsInProgress,previews:s.previews,submitting:!1,initialText:s.messageText,ctrlSend:Y.a.getBool(k.a.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),fullWidthTextBox:Y.a.get(F.CATEGORY_DISPLAY_SETTINGS,F.CHANNEL_DISPLAY_MODE,F.CHANNEL_DISPLAY_MODE_DEFAULT)===F.CHANNEL_DISPLAY_MODE_FULL_SCREEN,showTutorialTip:!1,showPostDeletedModal:!1},a}return f()(t,e),d()(t,[{key:"getCurrentDraft",value:function(){var e=w.a.getCurrentDraft(),t={previews:[],messageText:"",uploadsInProgress:[]};return e&&(e.message&&(t.messageText=e.message),e.previews&&(t.previews=e.previews),e.uploadsInProgress&&(t.uploadsInProgress=e.uploadsInProgress)),t}},{key:"handleSubmit",value:function(e){var t=this;if(e.preventDefault(),!(this.state.uploadsInProgress.length>0||this.state.submitting)){var a={};if(a.filenames=[],a.message=this.state.messageText,0!==a.message.trim().length||0!==this.state.previews.length){if(a.message.length>k.a.CHARACTER_LIMIT)return void this.setState({postError:"Post length must be less than "+k.a.CHARACTER_LIMIT+" characters."});b.a.storeMessageInHistory(this.state.messageText),this.setState({submitting:!0,serverError:null}),0===a.message.indexOf("/")?(w.a.storeDraft(this.state.channelId,null),this.setState({messageText:"",postError:null,previews:[]}),L.executeCommand(this.state.channelId,a.message,!1,function(e){t.setState({submitting:!1}),e.goto_location&&e.goto_location.length>0&&R.a.push(e.goto_location)},function(e){if(e.sendMessage)t.sendMessage(a);else{var s={};s.serverError=e.message,s.submitting=!1,t.setState(s)}})):this.sendMessage(a)}}}},{key:"sendMessage",value:function(e){var t=this;e.channel_id=this.state.channelId,e.filenames=this.state.previews;var a=D.getTimestamp(),s=O.a.getCurrentId();e.pending_post_id=s+":"+a,e.user_id=s,e.create_at=a,e.parent_id=this.state.parentId,y.emitUserPostedEvent(e),this.setState({messageText:"",submitting:!1,postError:null,previews:[],serverError:null}),A.a.createPost(e,function(t){w.a.removePendingPost(e.pending_post_id),I.a.handleServerAction({type:H.RECEIVED_POST,post:t})},function(a){"api.post.create_post.root_id.app_error"===a.id?(t.showPostDeletedModal(),w.a.removePendingPost(e.pending_post_id)):(e.state=k.a.POST_FAILED,w.a.updatePendingPost(e)),t.setState({submitting:!1})})}},{key:"focusTextbox",value:function(){D.isMobile()||this.refs.textbox.focus()}},{key:"postMsgKeyPress",value:function(e){!M.isMobileApp()&&(this.state.ctrlSend&&e.ctrlKey||!this.state.ctrlSend)&&(e.which!==B.ENTER||e.shiftKey||e.altKey||(e.preventDefault(),_.a.findDOMNode(this.refs.textbox).blur(),this.handleSubmit(e))),y.emitLocalUserTypingEvent(this.state.channelId,"")}},{key:"handleInput",value:function(e){var t=e.target.value;this.setState({messageText:t});var a=w.a.getCurrentDraft();a.message=t,w.a.storeCurrentDraft(a)}},{key:"handleUploadClick",value:function(){this.focusTextbox()}},{key:"handleUploadStart",value:function(e,t){var a=w.a.getDraft(t);a.uploadsInProgress=a.uploadsInProgress.concat(e),w.a.storeDraft(t,a),this.setState({uploadsInProgress:a.uploadsInProgress}),this.focusTextbox()}},{key:"handleFileUploadComplete",value:function(e,t,a){for(var s=w.a.getDraft(a),n=0;n<t.length;n++){var r=s.uploadsInProgress.indexOf(t[n]);r!==-1&&s.uploadsInProgress.splice(r,1)}s.previews=s.previews.concat(e),w.a.storeDraft(a,s),a===this.state.channelId&&this.setState({uploadsInProgress:s.uploadsInProgress,previews:s.previews})}},{key:"handleUploadError",value:function(e,t,a){var s=e;if(s&&"string"!=typeof s&&(s=e.message),t!==-1){var n=w.a.getDraft(a),r=n.uploadsInProgress.indexOf(t);r!==-1&&n.uploadsInProgress.splice(r,1),w.a.storeDraft(a,n),a===this.state.channelId&&this.setState({uploadsInProgress:n.uploadsInProgress})}this.setState({serverError:s})}},{key:"removePreview",value:function(e){var t=n()([],this.state.previews),a=this.state.uploadsInProgress,s=t.indexOf(e);s===-1?(s=a.indexOf(e),s!==-1&&(a.splice(s,1),this.refs.fileUpload.getWrappedInstance().cancelUpload(e))):t.splice(s,1);var r=w.a.getCurrentDraft();r.previews=t,r.uploadsInProgress=a,w.a.storeCurrentDraft(r),this.setState({previews:t,uploadsInProgress:a})}},{key:"componentWillMount",value:function(){var e=Y.a.getInt(F.TUTORIAL_STEP,O.a.getCurrentId(),999);this.setState({ctrlSend:Y.a.getBool(F.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),fullWidthTextBox:Y.a.get(F.CATEGORY_DISPLAY_SETTINGS,F.CHANNEL_DISPLAY_MODE,F.CHANNEL_DISPLAY_MODE_DEFAULT)===F.CHANNEL_DISPLAY_MODE_FULL_SCREEN,showTutorialTip:e===K.POST_POPOVER})}},{key:"componentDidMount",value:function(){N.a.addChangeListener(this.onChange),Y.a.addChangeListener(this.onPreferenceChange),this.focusTextbox(),document.addEventListener("keydown",this.showShortcuts)}},{key:"componentDidUpdate",value:function(e,t){t.channelId!==this.state.channelId&&this.focusTextbox()}},{key:"componentWillUnmount",value:function(){N.a.removeChangeListener(this.onChange),Y.a.removeChangeListener(this.onPreferenceChange),document.removeEventListener("keydown",this.showShortcuts)}},{key:"showShortcuts",value:function(e){var t=this;(e.ctrlKey||e.metaKey)&&e.keyCode===k.a.KeyCodes.FORWARD_SLASH&&(e.preventDefault(),L.executeCommand(this.state.channelId,"/shortcuts ",!1,null,function(e){t.setState({serverError:e.message,submitting:!1})}))}},{key:"onChange",value:function(){var e=N.a.getCurrentId();if(this.state.channelId!==e){var t=this.getCurrentDraft();this.setState({channelId:e,messageText:t.messageText,initialText:t.messageText,submitting:!1,serverError:null,postError:null,previews:t.previews,uploadsInProgress:t.uploadsInProgress})}}},{key:"onPreferenceChange",value:function(){var e=Y.a.getInt(F.TUTORIAL_STEP,O.a.getCurrentId(),999);this.setState({showTutorialTip:e===K.POST_POPOVER,ctrlSend:Y.a.getBool(F.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),fullWidthTextBox:Y.a.get(F.CATEGORY_DISPLAY_SETTINGS,F.CHANNEL_DISPLAY_MODE,F.CHANNEL_DISPLAY_MODE_DEFAULT)===F.CHANNEL_DISPLAY_MODE_FULL_SCREEN})}},{key:"getFileCount",value:function(e){if(e===this.state.channelId)return this.state.previews.length+this.state.uploadsInProgress.length;var t=w.a.getDraft(e);return t.previews.length+t.uploadsInProgress.length}},{key:"handleKeyDown",value:function(e){if(this.state.ctrlSend&&e.keyCode===B.ENTER&&e.ctrlKey===!0)return void this.postMsgKeyPress(e);if(!(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.keyCode!==B.UP||""!==this.state.messageText)){e.preventDefault();var t=N.a.getCurrentId(),a=w.a.getCurrentUsersLatestPost(t);if(!a)return;var s=void 0;s=a.root_id&&a.root_id.length>0?D.localizeMessage("create_post.comment","Comment"):D.localizeMessage("create_post.post","Post"),I.a.handleViewAction({type:H.RECEIVED_EDIT_POST,refocusId:"#post_textbox",title:s,message:a.message,postId:a.id,channelId:a.channel_id,comments:w.a.getCommentCount(a)})}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&(e.keyCode===k.a.KeyCodes.UP||e.keyCode===k.a.KeyCodes.DOWN)){var n=b.a.nextMessageInHistory(e.keyCode,this.state.messageText,"post");null!==n&&(e.preventDefault(),this.setState({messageText:n}))}}},{key:"showPostDeletedModal",value:function(){this.setState({showPostDeletedModal:!0})}},{key:"hidePostDeletedModal",value:function(){this.setState({showPostDeletedModal:!1})}},{key:"createTutorialTip",value:function(){var e=[];return e.push(V.a.createElement("div",null,V.a.createElement(G.FormattedHTMLMessage,{id:"create_post.tutorialTip",defaultMessage:"<h4>Sending Messages</h4><p>Type here to write a message and press <strong>Enter</strong> to post it.</p><p>Click the <strong>Attachment</strong> button to upload an image or a file.</p>"}))),V.a.createElement(C.b,{placement:"top",screens:e,overlayClass:"tip-overlay--chat"})}},{key:"render",value:function(){var e=null;this.state.serverError&&(e=V.a.createElement("div",{className:"has-error"},V.a.createElement("label",{className:"control-label"},this.state.serverError)));var t=null;this.state.postError&&(t=V.a.createElement("label",{className:"control-label"},this.state.postError));var a=null;(this.state.previews.length>0||this.state.uploadsInProgress.length>0)&&(a=V.a.createElement(T.a,{files:this.state.previews,onRemove:this.removePreview,uploadsInProgress:this.state.uploadsInProgress}));var s="post-create-footer";t&&(s+=" has-error");var n=null;this.state.showTutorialTip&&(n=this.createTutorialTip());var r="";return this.state.fullWidthTextBox||(r="center"),V.a.createElement("form",{id:"create_post",ref:"topDiv",role:"form",className:r,onSubmit:this.handleSubmit},V.a.createElement("div",{className:"post-create"},V.a.createElement("div",{className:"post-create-body"},V.a.createElement("div",{className:"post-body__cell"},V.a.createElement(S.a,{onInput:this.handleInput,onKeyPress:this.postMsgKeyPress,onKeyDown:this.handleKeyDown,messageText:this.state.messageText,createMessage:D.localizeMessage("create_post.write","Write a message..."),channelId:this.state.channelId,id:"post_textbox",ref:"textbox"}),V.a.createElement(E.a,{ref:"fileUpload",getFileCount:this.getFileCount,onClick:this.handleUploadClick,onUploadStart:this.handleUploadStart,onFileUpload:this.handleFileUploadComplete,onUploadError:this.handleUploadError,postType:"post",channelId:""})),V.a.createElement("a",{className:"send-button theme",onClick:this.handleSubmit},V.a.createElement("i",{className:"fa fa-paper-plane"})),n),V.a.createElement("div",{className:s},V.a.createElement(v.a,{channelId:this.state.channelId,parentId:""}),a,t,e)),V.a.createElement(m.a,{show:this.state.showPostDeletedModal,onHide:this.hidePostDeletedModal}))}}]),t}(V.a.Component);t.a=W},1871:function(e,t,a){"use strict";var s=a(42),n=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(n,"a",n);var r=a(6),o=r&&r.__esModule?function(){return r["default"]}:function(){return r};a.d(o,"a",o);var i=a(3),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var u=a(4),d=u&&u.__esModule?function(){return u["default"]}:function(){return u};a.d(d,"a",d);var c=a(7),h=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(h,"a",h);var p=a(2),f=p&&p.__esModule?function(){return p["default"]}:function(){return p};a.d(f,"a",f);var g=a(1872),_=a(36),v=a(26),S=a(1),E=S&&S.__esModule?function(){return S["default"]}:function(){return S};a.d(E,"a",E);var T=5,m=function(e){function t(e){l()(this,t);var a=h()(this,(t.__proto__||o()(t)).call(this,e));a.onChannelChange=a.onChannelChange.bind(a);var s=_.a.getCurrent();return a.state={currentChannelId:s.id,channels:[s]},a}return f()(t,e),d()(t,[{key:"componentDidMount",value:function(){_.a.addChangeListener(this.onChannelChange)}},{key:"componentWillUnmount",value:function(){v.setActiveChannel(""),_.a.removeChangeListener(this.onChannelChange)}},{key:"onChannelChange",value:function(){var e=n()([],this.state.channels),t=_.a.getCurrent();if(null!=t&&t.id!==this.state.currentChannelId){e.length>T&&e.shift();var a=e.map(function(e){return e.id}).indexOf(t.id);a!==-1&&e.splice(a,1),e.push(t),this.setState({currentChannelId:t.id,channels:e})}}},{key:"render",value:function(){for(var e=this.state.channels,t=this.state.currentChannelId,a=[],s=0;s<e.length;s++)a.push(E.a.createElement(g.a,{key:"postviewcontroller_"+e[s].id,channel:e[s],active:e[s].id===t}));return E.a.createElement("div",{id:"post-list"},a)}}]),t}(E.a.Component);t.a=m},1872:function(e,t,a){"use strict";var s=a(112),n=s&&s.__esModule?function(){return s["default"]}:function(){return s};a.d(n,"a",n);var r=a(42),o=r&&r.__esModule?function(){return r["default"]}:function(){return r};a.d(o,"a",o);var i=a(6),l=i&&i.__esModule?function(){return i["default"]}:function(){return i};a.d(l,"a",l);var u=a(3),d=u&&u.__esModule?function(){return u["default"]}:function(){return u};a.d(d,"a",d);var c=a(4),h=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(h,"a",h);var p=a(7),f=p&&p.__esModule?function(){return p["default"]}:function(){return p};a.d(f,"a",f);var g=a(2),_=g&&g.__esModule?function(){return g["default"]}:function(){return g};a.d(_,"a",_);var v=a(1652),S=a(152),E=a(45),T=a(18),m=a(153),C=a(36),P=a(13),I=a(11),y=a(1),A=y&&y.__esModule?function(){return y["default"]}:function(){return y};a.d(A,"a",A);var D=I.a.Preferences,M=I.a.ScrollTypes,L=function(e){function t(e){d()(this,t);var a=f()(this,(t.__proto__||l()(t)).call(this,e));a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onUserChange=a.onUserChange.bind(a),a.onPostsChange=a.onPostsChange.bind(a),a.onStatusChange=a.onStatusChange.bind(a),a.onPostsViewJumpRequest=a.onPostsViewJumpRequest.bind(a),a.onSetNewMessageIndicator=a.onSetNewMessageIndicator.bind(a),a.onPostListScroll=a.onPostListScroll.bind(a),a.onActivate=a.onActivate.bind(a),a.onDeactivate=a.onDeactivate.bind(a);var s=e.channel,n=T.a.getProfiles();s&&s.type===I.a.DM_CHANNEL&&(n=o()({},n,T.a.getDirectProfiles()));var r=Number.MAX_VALUE,i=C.a.getMember(s.id);null!=i&&(r=i.last_viewed_at);var u=E.a.getBool(I.a.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0),c=o()({},T.a.getStatuses()),h=0===m.a.getLatestPostFromPageTime(s.id);return a.state={channel:s,postList:m.a.filterPosts(s.id,u),currentUser:T.a.getCurrentUser(),profiles:n,statuses:c,atTop:m.a.getVisibilityAtTop(s.id),lastViewed:r,ownNewMessage:!1,loading:h,scrollType:M.NEW_MESSAGE,displayNameType:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,"name_format","false"),displayPostsInCenter:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.CHANNEL_DISPLAY_MODE,D.CHANNEL_DISPLAY_MODE_DEFAULT)===D.CHANNEL_DISPLAY_MODE_CENTERED,compactDisplay:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.MESSAGE_DISPLAY,D.MESSAGE_DISPLAY_DEFAULT)===D.MESSAGE_DISPLAY_COMPACT,previewsCollapsed:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.COLLAPSE_DISPLAY,"false"),useMilitaryTime:E.a.getBool(I.a.Preferences.CATEGORY_DISPLAY_SETTINGS,D.USE_MILITARY_TIME,!1),flaggedPosts:E.a.getCategory(I.a.Preferences.CATEGORY_FLAGGED_POST)},a}return _()(t,e),h()(t,[{key:"componentDidMount",value:function(){this.props.active&&this.onActivate()}},{key:"componentWillUnmount",value:function(){this.props.active&&this.onDeactivate()}},{key:"onPreferenceChange",value:function(e){var t="";e===D.CATEGORY_DISPLAY_SETTINGS&&(t="_"+P.generateId());var a=E.a.getBool(I.a.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0);this.setState({postList:m.a.filterPosts(this.state.channel.id,a),displayNameType:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,"name_format","false"),displayPostsInCenter:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.CHANNEL_DISPLAY_MODE,D.CHANNEL_DISPLAY_MODE_DEFAULT)===D.CHANNEL_DISPLAY_MODE_CENTERED,compactDisplay:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.MESSAGE_DISPLAY,D.MESSAGE_DISPLAY_DEFAULT)===D.MESSAGE_DISPLAY_COMPACT,previewsCollapsed:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.COLLAPSE_DISPLAY,"false")+t,useMilitaryTime:E.a.getBool(I.a.Preferences.CATEGORY_DISPLAY_SETTINGS,D.USE_MILITARY_TIME,!1),flaggedPosts:E.a.getCategory(I.a.Preferences.CATEGORY_FLAGGED_POST)})}},{key:"onUserChange",value:function(){var e=this.state.channel,t=T.a.getProfiles();e&&e.type===I.a.DM_CHANNEL&&(t=o()({},t,T.a.getDirectProfiles())),this.setState({currentUser:T.a.getCurrentUser(),profiles:JSON.parse(n()(t))})}},{key:"onPostsChange",value:function(){var e=E.a.getBool(I.a.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0),t=0===m.a.getLatestPostFromPageTime(this.state.channel.id),a={postList:m.a.filterPosts(this.state.channel.id,e),atTop:m.a.getVisibilityAtTop(this.state.channel.id),loading:t};this.state.loading&&!t&&(a.scrollType=M.NEW_MESSAGE),this.setState(a)}},{key:"onStatusChange",value:function(){this.setState({statuses:o()({},T.a.getStatuses())})}},{key:"onActivate",value:function(){E.a.addChangeListener(this.onPreferenceChange),T.a.addChangeListener(this.onUserChange),T.a.addStatusesChangeListener(this.onStatusChange),m.a.addChangeListener(this.onPostsChange),m.a.addPostsViewJumpListener(this.onPostsViewJumpRequest),C.a.addLastViewedListener(this.onSetNewMessageIndicator)}},{key:"onDeactivate",value:function(){E.a.removeChangeListener(this.onPreferenceChange),T.a.removeChangeListener(this.onUserChange),T.a.removeStatusesChangeListener(this.onStatusChange),m.a.removeChangeListener(this.onPostsChange),m.a.removePostsViewJumpListener(this.onPostsViewJumpRequest),C.a.removeLastViewedListener(this.onSetNewMessageIndicator)}},{key:"componentWillReceiveProps",value:function(e){if(this.props.active&&!e.active)this.onDeactivate();else if(!this.props.active&&e.active){this.onActivate();var t=e.channel,a=Number.MAX_VALUE,s=C.a.getMember(t.id);null!=s&&(a=s.last_viewed_at);var r=T.a.getProfiles();t&&t.type===I.a.DM_CHANNEL&&(r=o()({},r,T.a.getDirectProfiles()));var i=E.a.getBool(I.a.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0);this.setState({channel:t,lastViewed:a,ownNewMessage:!1,profiles:JSON.parse(n()(r)),postList:m.a.filterPosts(t.id,i),displayNameType:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,"name_format","false"),displayPostsInCenter:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.CHANNEL_DISPLAY_MODE,D.CHANNEL_DISPLAY_MODE_DEFAULT)===D.CHANNEL_DISPLAY_MODE_CENTERED,compactDisplay:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.MESSAGE_DISPLAY,D.MESSAGE_DISPLAY_DEFAULT)===D.MESSAGE_DISPLAY_COMPACT,previewsCollapsed:E.a.get(D.CATEGORY_DISPLAY_SETTINGS,D.COLLAPSE_DISPLAY,"false"),useMilitaryTime:E.a.getBool(I.a.Preferences.CATEGORY_DISPLAY_SETTINGS,D.USE_MILITARY_TIME,!1),scrollType:M.NEW_MESSAGE})}}},{key:"onPostsViewJumpRequest",value:function(e,t){switch(e){case I.a.PostsViewJumpTypes.BOTTOM:this.setState({scrollType:M.BOTTOM});break;case I.a.PostsViewJumpTypes.POST:this.setState({scrollType:M.POST,scrollPostId:t});break;case I.a.PostsViewJumpTypes.SIDEBAR_OPEN:this.setState({scrollType:M.SIDEBAR_OPEN})}}},{key:"onSetNewMessageIndicator",value:function(e,t){this.setState({lastViewed:e,ownNewMessage:t})}},{key:"onPostListScroll",value:function(e){e?this.setState({scrollType:M.BOTTOM}):this.setState({scrollType:M.FREE})}},{key:"shouldComponentUpdate",value:function(e,t){return e.active!==this.props.active||(t.loading!==this.state.loading||(t.atTop!==this.state.atTop||(t.displayNameType!==this.state.displayNameType||(t.displayPostsInCenter!==this.state.displayPostsInCenter||(t.compactDisplay!==this.state.compactDisplay||(t.previewsCollapsed!==this.state.previewsCollapsed||(t.useMilitaryTime!==this.state.useMilitaryTime||(!P.areObjectsEqual(t.flaggedPosts,this.state.flaggedPosts)||(t.lastViewed!==this.state.lastViewed||(t.ownNewMessage!==this.state.ownNewMessage||(t.showMoreMessagesTop!==this.state.showMoreMessagesTop||(t.scrollType!==this.state.scrollType||(t.scrollPostId!==this.state.scrollPostId||(e.channel.id!==this.props.channel.id||(!P.areObjectsEqual(t.currentUser,this.state.currentUser)||(!P.areObjectsEqual(t.statuses,this.state.statuses)||(!P.areObjectsEqual(t.postList,this.state.postList)||!P.areObjectsEqual(t.profiles,this.state.profiles))))))))))))))))))}},{key:"render",value:function(){var e=void 0;e=null==this.state.postList||this.state.loading?A.a.createElement(S.a,{position:"absolute",key:"loading"}):A.a.createElement(v.a,{postList:this.state.postList,profiles:this.state.profiles,channel:this.state.channel,currentUser:this.state.currentUser,showMoreMessagesTop:!this.state.atTop,scrollType:this.state.scrollType,scrollPostId:this.state.scrollPostId,postListScrolled:this.onPostListScroll,displayNameType:this.state.displayNameType,displayPostsInCenter:this.state.displayPostsInCenter,compactDisplay:this.state.compactDisplay,previewsCollapsed:this.state.previewsCollapsed,useMilitaryTime:this.state.useMilitaryTime,flaggedPosts:this.state.flaggedPosts,lastViewed:this.state.lastViewed,ownNewMessage:this.state.ownNewMessage,statuses:this.state.statuses});var t="";return this.props.active||(t="inactive"),A.a.createElement("div",{className:t},e)}}]),t}(A.a.Component);t.a=L,L.propTypes={channel:A.a.PropTypes.object,active:A.a.PropTypes.bool}}});