webpackJsonp([24],{1697:function(e,a,t){"use strict";(function(e){var r=t(112),s=r&&r.__esModule?function(){return r["default"]}:function(){return r};t.d(s,"a",s);var n=t(6),l=n&&n.__esModule?function(){return n["default"]}:function(){return n};t.d(l,"a",l);var i=t(3),o=i&&i.__esModule?function(){return i["default"]}:function(){return i};t.d(o,"a",o);var m=t(7),u=m&&m.__esModule?function(){return m["default"]}:function(){return m};t.d(u,"a",u);var c=t(4),d=c&&c.__esModule?function(){return c["default"]}:function(){return c};t.d(d,"a",d);var p=t(2),E=p&&p.__esModule?function(){return p["default"]}:function(){return p};t.d(E,"a",E);var h=t(152),f=t(54),g=t(566),v=t(85),_=t(13),M=t(19),N=t(11),w=t(1),y=w&&w.__esModule?function(){return w["default"]}:function(){return w};t.d(y,"a",y);var b=t(12),S=b&&b.__esModule?function(){return b["default"]}:function(){return b};t.d(S,"a",S);var I=t(53),k=t(1632),F=k&&k.__esModule?function(){return k["default"]}:function(){return k};t.d(F,"a",F);var C=function(a){function r(e){o()(this,r);var a=u()(this,(r.__proto__||l()(r)).call(this,e));return a.handleSubmit=a.handleSubmit.bind(a),a.getInviteInfo=a.getInviteInfo.bind(a),a.renderEmailSignup=a.renderEmailSignup.bind(a),a.isUserValid=a.isUserValid.bind(a),a.state=a.getInviteInfo(),a}return E()(r,a),d()(r,null,[{key:"propTypes",get:function(){return{location:y.a.PropTypes.object}}}]),d()(r,[{key:"getInviteInfo",value:function(){var e=this.props.location.query.d,a=this.props.location.query.h,t=this.props.location.query.id,r="",s="",n="",l="",i=!0,o="",m=!1;if(a&&a.length>0){var u=JSON.parse(e);r=u.email,s=u.display_name,n=u.name,l=u.id,i=!1}else t&&t.length>0?(i=!0,M.a.getInviteInfo(t,function(e){e&&(o="",s=e.display_name,n=e.name,l=e.id)},function(){m=!0,o=y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.invalid_invite",defaultMessage:"The invite link was invalid.  Please speak with your Administrator to receive an invitation."})}),i=!1,e=null,a=null):i=!1;return{data:e,hash:a,email:r,teamDisplayName:s,teamName:n,teamId:l,inviteId:t,loading:i,serverError:o,noOpenServerError:m}}},{key:"finishSignup",value:function(){var e=this;f.emitInitialLoad(function(){var a=e.props.location.query;f.loadDefaultLocale(),a.redirect_to?I.a.push(a.redirect_to):I.a.push("/select_team")})}},{key:"handleSignupSuccess",value:function(e,a){var r=this;t.i(g.b)("signup","signup_user_02_complete"),M.a.loginById(a.id,e.password,"",function(){r.state.hash>0&&v.a.setGlobalItem(r.state.hash,s()({usedBefore:!0})),f.emitInitialLoad(function(){var e=r.props.location.query;e.redirect_to?I.a.push(e.redirect_to):I.a.push("/select_team")})},function(a){"api.user.login.not_verified.app_error"===a.id?I.a.push("/should_verify_email?email="+encodeURIComponent(e.email)+"&teamname="+encodeURIComponent(r.state.teamName)):r.setState({serverError:a.message})})}},{key:"isUserValid",value:function(){var e=this.refs.email.value.trim();if(!e)return this.setState({nameError:"",emailError:y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.required"}),passwordError:"",serverError:""}),!1;if(!_.isEmail(e))return this.setState({nameError:"",emailError:y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.validEmail"}),passwordError:"",serverError:""}),!1;var a=this.refs.name.value.trim().toLowerCase();if(!a)return this.setState({nameError:y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.required"}),emailError:"",passwordError:"",serverError:""}),!1;var t=_.isValidUsername(a);if("Cannot use a reserved word as a username."===t)return this.setState({nameError:y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.reserved"}),emailError:"",passwordError:"",serverError:""}),!1;if(t)return this.setState({nameError:y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.usernameLength",values:{min:N.a.MIN_USERNAME_LENGTH,max:N.a.MAX_USERNAME_LENGTH}}),emailError:"",passwordError:"",serverError:""}),!1;var r=this.refs.password.value,s=_.isValidPassword(r);return!s||(this.setState({nameError:"",emailError:"",passwordError:s,serverError:""}),!1)}},{key:"handleSubmit",value:function(e){var a=this;if(e.preventDefault(),this.isUserValid()){this.setState({nameError:"",emailError:"",passwordError:"",serverError:""});var t={email:this.refs.email.value.trim(),username:this.refs.name.value.trim().toLowerCase(),password:this.refs.password.value,allow_marketing:!0};M.a.createUserWithInvite(t,this.state.data,this.state.hash,this.state.inviteId,this.handleSignupSuccess.bind(this,t),function(e){a.setState({serverError:e.message})})}}},{key:"renderEmailSignup",value:function(){var a=null,t=y.a.createElement("span",{className:"help-block"},y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.emailHelp",defaultMessage:"Valid email required for sign-up"})),r="form-group";this.state.emailError&&(a=y.a.createElement("label",{className:"control-label"},this.state.emailError),t="",r+=" has-error");var s=null,n=y.a.createElement("span",{className:"help-block"},y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.userHelp",defaultMessage:"Username must begin with a letter, and contain between {min} to {max} lowercase characters made up of numbers, letters, and the symbols '.', '-' and '_'",values:{min:N.a.MIN_USERNAME_LENGTH,max:N.a.MAX_USERNAME_LENGTH}})),l="form-group";this.state.nameError&&(s=y.a.createElement("label",{className:"control-label"},this.state.nameError),n="",l+=" has-error");var i=null,o="form-group";this.state.passwordError&&(i=y.a.createElement("label",{className:"control-label"},this.state.passwordError),o+=" has-error");var m=null;this.state.email&&(m=y.a.createElement(b.FormattedHTMLMessage,{id:"signup_user_completed.emailIs",defaultMessage:"Your email address is <strong>{email}</strong>. You'll use this address to sign in to {siteName}.",values:{email:this.state.email,siteName:e.window.mm_config.SiteName}}));var u="margin--extra";return this.state.email&&(u="hidden"),y.a.createElement("form",null,y.a.createElement("div",{className:"inner__content"},y.a.createElement("div",{className:u},y.a.createElement("h5",null,y.a.createElement("strong",null,y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.whatis",defaultMessage:"What's your email address?"}))),y.a.createElement("div",{className:r},y.a.createElement("input",{type:"email",ref:"email",className:"form-control",defaultValue:this.state.email,placeholder:"",maxLength:"128",autoFocus:!0,spellCheck:"false",autoCapitalize:"off"}),a,t)),m,y.a.createElement("div",{className:"margin--extra"},y.a.createElement("h5",null,y.a.createElement("strong",null,y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.chooseUser",defaultMessage:"Choose your username"}))),y.a.createElement("div",{className:l},y.a.createElement("input",{type:"text",ref:"name",className:"form-control",placeholder:"",maxLength:N.a.MAX_USERNAME_LENGTH,spellCheck:"false",autoCapitalize:"off"}),s,n)),y.a.createElement("div",{className:"margin--extra"},y.a.createElement("h5",null,y.a.createElement("strong",null,y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.choosePwd",defaultMessage:"Choose your password"}))),y.a.createElement("div",{className:o},y.a.createElement("input",{type:"password",ref:"password",className:"form-control",placeholder:"",maxLength:"128",spellCheck:"false"}),i)),y.a.createElement("p",{className:"margin--extra"},y.a.createElement("button",{type:"submit",onClick:this.handleSubmit,className:"btn-primary btn"},y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.create",defaultMessage:"Create Account"})))))}},{key:"render",value:function(){t.i(g.b)("signup","signup_user_01_welcome");var a=null;if(this.state.serverError&&(a=y.a.createElement("div",{className:"form-group has-error"},y.a.createElement("label",{className:"control-label"},this.state.serverError))),this.state.loading)return y.a.createElement(h.a,null);var r=void 0;if("true"!==e.window.mm_config.EnableSignUpWithEmail)return null;r=this.renderEmailSignup();var s=null;!this.state.noOpenServerError&&r&&(s=y.a.createElement("p",null,y.a.createElement(b.FormattedHTMLMessage,{id:"create_team.agreement",defaultMessage:"By proceeding to create your account and use {siteName}, you agree to our <a href='/static/help/terms.html'>Terms of Service</a> and <a href='/static/help/privacy.html'>Privacy Policy</a>. If you do not agree, you cannot use {siteName}.",values:{siteName:e.window.mm_config.SiteName}}))),this.state.noOpenServerError&&(r=null);var n=null;return n="true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand?e.window.mm_config.CustomDescriptionText:y.a.createElement(b.FormattedMessage,{id:"web.root.signup_info",defaultMessage:"All team communication in one place, searchable and accessible anywhere"}),y.a.createElement("div",null,y.a.createElement("div",{className:"signup-header"},y.a.createElement(I.b,{to:"/signup_user_complete"},y.a.createElement("span",{className:"fa fa-chevron-left"}),y.a.createElement(b.FormattedMessage,{id:"web.header.back"}))),y.a.createElement("div",{className:"col-sm-12"},y.a.createElement("div",{className:"signup-team__container padding--less"},y.a.createElement("img",{className:"signup-team-logo",src:F.a}),y.a.createElement("h1",null,e.window.mm_config.SiteName),y.a.createElement("h4",{className:"color--light"},n),y.a.createElement("h4",{className:"color--light"},y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.lets",defaultMessage:"Let's create your account"})),y.a.createElement("span",{className:"color--light"},y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.haveAccount",defaultMessage:"Already have an account?"})," ",y.a.createElement(I.b,{to:"/login",query:this.props.location.query},y.a.createElement(b.FormattedMessage,{id:"signup_user_completed.signIn",defaultMessage:"Click here to sign in."}))),r,a,s)))}}]),r}(y.a.Component);a["default"]=C}).call(a,t(17))}});